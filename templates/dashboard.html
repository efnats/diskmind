<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>diskmind</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 24 24' fill='none' stroke='%233b82f6' stroke-width='1.8' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M12 5a7 7 0 0 1 7 7'/%3E%3Cpath d='M12 19a7 7 0 0 1-7-7'/%3E%3Ccircle cx='12' cy='12' r='3.5'/%3E%3Ccircle cx='12' cy='12' r='1.2' fill='%233b82f6' stroke='none'/%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1><svg class="logo-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 5a7 7 0 0 1 7 7"/><path d="M12 19a7 7 0 0 1-7-7"/><circle cx="12" cy="12" r="3.5"/><circle cx="12" cy="12" r="1.2" fill="currentColor" stroke="none"/></svg>diskmind</h1>
            <div class="header-right">
                <span class="timestamp" id="lastUpdate">Loading...</span>
                <button class="btn icon-btn" onclick="toggleTheme()" id="themeBtn" title="Toggle theme">
                    <svg id="themeSun" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                    <svg id="themeMoon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </button>
                <div class="alert-btn-wrap">
                    <button class="btn icon-btn" onclick="toggleAlerts()" id="alertsBtn" title="Alerts">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    </button>
                    <span class="alert-badge" id="alertBadge"></span>
                </div>
                <button class="btn icon-btn" onclick="toggleSettings()" id="settingsBtn" title="Settings">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                </button>
            </div>
        </header>
        
        <div id="error" class="error" style="display: none;"></div>
        <div id="connectionBanner" class="connection-banner">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="1" y1="1" x2="23" y2="23"/><path d="M16.72 11.06A10.94 10.94 0 0 1 19 12.55"/><path d="M5 12.55a10.94 10.94 0 0 1 5.17-2.39"/><path d="M10.71 5.05A16 16 0 0 1 22.56 9"/><path d="M1.42 9a15.91 15.91 0 0 1 4.7-2.88"/><path d="M8.53 16.11a6 6 0 0 1 6.95 0"/><line x1="12" y1="20" x2="12.01" y2="20"/></svg>
            <span id="connectionMsg">Connection lost — retrying…</span>
        </div>
        
        <div class="stats">
            <div class="stat" onclick="filterStatus('')">
                <div class="stat-label">Total</div>
                <div class="stat-value" id="statTotal">-</div>
                <div class="stat-sub" id="statCapacity">-</div>
            </div>
            <div class="stat healthy" onclick="filterStatus('ok')">
                <div class="stat-label">Healthy</div>
                <div class="stat-value" id="statHealthy">-</div>
                <div class="stat-sub">No Issues</div>
            </div>
            <div class="stat warning" onclick="filterStatus('warning')">
                <div class="stat-label">Warning</div>
                <div class="stat-value" id="statWarning">-</div>
                <div class="stat-sub" id="statWarningSub">Need Attention</div>
            </div>
            <div class="stat critical" onclick="filterStatus('critical')">
                <div class="stat-label">Critical</div>
                <div class="stat-value" id="statCritical">-</div>
                <div class="stat-sub">Failing</div>
            </div>
            <div class="stat missing" onclick="filterStatus('missing')">
                <div class="stat-label">Missing</div>
                <div class="stat-value" id="statMissing">-</div>
                <div class="stat-sub" id="statMissingSub">Not Seen</div>
            </div>
            <div class="stat archived" onclick="filterStatus('archived')">
                <div class="stat-label">Archived</div>
                <div class="stat-value" id="statArchived">-</div>
                <div class="stat-sub">Stored</div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-group-labeled">
                <span class="filter-group-label">Type</span>
                <div class="filter-group-controls">
                    <div class="custom-select" id="typeFilterWrapper">
                        <div class="custom-select-trigger" onclick="toggleDropdown('typeFilterWrapper')">
                            <span class="custom-select-value">All Types</span>
                            <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-select-option selected" data-value="">All Types</div>
                            <div class="custom-select-option" data-value="HDD">HDD</div>
                            <div class="custom-select-option" data-value="SSD">SSD</div>
                            <div class="custom-select-option" data-value="NVMe">NVMe</div>
                        </div>
                    </div>
                    <input type="hidden" id="typeFilter" value="">
                    <input type="text" id="search" class="search-input" placeholder="Search..." onkeyup="applyFilters()">
                </div>
            </div>
            <div class="filter-separator"></div>
            <div class="filter-group-labeled">
                <span class="filter-group-label">Thresholds <span class="info-icon" data-tip="Warning/critical limits for SMART values. Click ⚙ for details.">ⓘ</span></span>
                <div class="filter-group-controls">
                    <div class="custom-select" id="presetFilterWrapper">
                        <div class="custom-select-trigger" onclick="toggleDropdown('presetFilterWrapper')">
                            <span class="custom-select-value">Backblaze</span>
                            <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-select-option" data-value="relaxed">Relaxed</div>
                            <div class="custom-select-option" data-value="conservative">Conservative</div>
                            <div class="custom-select-option selected" data-value="backblaze">Backblaze</div>
                            <div class="custom-select-option" data-value="custom">Custom</div>
                        </div>
                    </div>
                    <input type="hidden" id="presetFilter" value="backblaze">
                    <button class="edit-thresholds-btn" onclick="toggleThresholdEditor()" title="Edit thresholds">⚙</button>
                </div>
            </div>
            <div class="filter-separator"></div>
            <div class="filter-group-labeled">
                <span class="filter-group-label">History <span class="info-icon" data-tip="Time range for issue detection. Event counters only alert if they increased within this period.">ⓘ</span></span>
                <div class="filter-group-controls">
                    <div class="custom-select" id="deltaRangeWrapper">
                        <div class="custom-select-trigger" onclick="toggleDropdown('deltaRangeWrapper')">
                            <span class="custom-select-value">7 days</span>
                            <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-select-option" data-value="1h">1 hour</div>
                            <div class="custom-select-option" data-value="24h">24 hours</div>
                            <div class="custom-select-option selected" data-value="7d">7 days</div>
                            <div class="custom-select-option" data-value="30d">30 days</div>
                            <div class="custom-select-option" data-value="90d">90 days</div>
                            <div class="custom-select-option" data-value="all">all time</div>
                        </div>
                    </div>
                    <input type="hidden" id="deltaRange" value="7d">
                </div>
            </div>
            <div class="filter-separator"></div>
            <div class="filter-group-labeled">
                <span class="filter-group-label">Hosts</span>
                <div class="filter-group-controls">
                    <div class="custom-select" id="hostFilterWrapper">
                        <div class="custom-select-trigger" onclick="toggleDropdown('hostFilterWrapper')">
                            <span class="custom-select-value">All Hosts</span>
                            <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </div>
                        <div class="custom-select-options">
                            <div class="custom-select-option selected" data-value="">All Hosts</div>
                        </div>
                    </div>
                    <input type="hidden" id="hostFilter" value="">
                    <button class="host-toolbar-btn" onclick="refreshAllHosts()" title="Fetch SMART data">↻</button>
                    <button id="addHostBtn" class="host-toolbar-btn" onclick="showAddHostInput()" title="Add host">+</button>
                </div>
                <div id="addHostInline" class="add-host-input-group" style="display:none;">
                    <div class="method-toggle" id="addHostMethodToggle">
                        <button type="button" class="method-toggle-btn active" onclick="setAddMethod('ssh')">SSH</button>
                        <button type="button" class="method-toggle-btn" onclick="setAddMethod('push')">Push</button>
                    </div>
                    <span id="addHostSshFields">
                        <input type="text" id="addHostUser" class="add-host-input add-host-user" placeholder="user" title="SSH user (e.g. root)">
                        <span class="add-host-at">@</span>
                    </span>
                    <input type="text" id="addHostInput" class="add-host-input" placeholder="IP or hostname" onkeydown="handleAddHostKey(event)">
                    <span id="addHostPortField">
                        <span class="add-host-at">:</span>
                        <input type="text" id="addHostPort" class="add-host-input add-host-port" placeholder="22" title="SSH port (default: 22)">
                    </span>
                    <button class="add-host-confirm" onclick="addHostFromInput()">✓</button>
                    <button class="add-host-cancel" onclick="hideAddHostInput()">✕</button>
                    <input type="hidden" id="addHostMethod" value="ssh">
                </div>
            </div>
        </div>
        
        <div id="content"><div class="loading">Loading...</div></div>
        
        <footer class="footer">
            <a href="https://github.com/efnats/diskmind" target="_blank" rel="noopener" class="footer-link">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                diskmind v{{VERSION}}
            </a>
        </footer>
    </div>
    
    <!-- Alerts Overlay -->
    <div id="alertsOverlay" class="alerts-overlay" onclick="if(event.target===this)toggleAlerts()">
        <div class="alerts-panel" onclick="event.stopPropagation()">
            <div class="alerts-header">
                <h2>Alerts <span class="alerts-header-count" id="alertsHeaderCount"></span></h2>
                <div class="alerts-header-actions">
                    <button class="alerts-ack-all" id="alertsAckAll" onclick="acknowledgeAllAlerts()" title="Mark all as read">Mark all read</button>
                    <button class="alerts-close" onclick="toggleAlerts();toggleSettings('notifications')" title="Notification settings"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></button>
                    <button class="alerts-close" onclick="toggleAlerts()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>
            </div>
            <div class="alerts-filters" id="alertsFilters">
                <div class="alerts-filter-tab active" data-sev="all" onclick="filterAlerts('all')">All <span class="alerts-filter-count" id="alertCountAll"></span></div>
                <div class="alerts-filter-tab" data-sev="critical" onclick="filterAlerts('critical')">Critical <span class="alerts-filter-count" id="alertCountCritical"></span></div>
                <div class="alerts-filter-tab" data-sev="warning" onclick="filterAlerts('warning')">Warning <span class="alerts-filter-count" id="alertCountWarning"></span></div>
                <div class="alerts-filter-tab" data-sev="info" onclick="filterAlerts('info')">Info <span class="alerts-filter-count" id="alertCountInfo"></span></div>
                <div class="alerts-filter-tab" data-sev="recovery" onclick="filterAlerts('recovery')">Recovery <span class="alerts-filter-count" id="alertCountRecovery"></span></div>
            </div>
            <div class="alerts-body" id="alertsBody">
                <div class="alerts-empty" id="alertsEmpty">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                    <span>No alerts yet</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Overlay -->
    <div id="settingsOverlay" class="settings-overlay" onclick="if(event.target===this)toggleSettings()">
        <div class="settings-panel" id="settingsPanel" onclick="event.stopPropagation()">
            <div class="settings-header">
                <h2>Settings</h2>
                <button class="settings-close" onclick="toggleSettings()"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
            </div>
            <div class="settings-tabs">
                <div class="settings-tab active" data-tab="general" onclick="switchSettingsTab('general')">General</div>
                <div class="settings-tab" data-tab="notifications" onclick="switchSettingsTab('notifications')">Notifications</div>
                <div class="settings-tab" data-tab="thresholds" onclick="switchSettingsTab('thresholds')">Thresholds</div>
            </div>
            <div class="settings-body">
                <!-- General Tab -->
                <div class="settings-tab-content active" id="tabGeneral">
                    <div class="settings-section-title">Display</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Temperature unit</span>
                        <div class="custom-select" id="tempUnitWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('tempUnitWrapper')">
                                <span class="custom-select-value">Celsius (°C)</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option selected" data-value="C">Celsius (°C)</div>
                                <div class="custom-select-option" data-value="F">Fahrenheit (°F)</div>
                            </div>
                        </div>
                        <input type="hidden" id="tempUnitSelect" value="C">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Size unit</span>
                        <div class="custom-select" id="sizeUnitWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('sizeUnitWrapper')">
                                <span class="custom-select-value">Decimal (GB, TB)</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option selected" data-value="decimal">Decimal (GB, TB)</div>
                                <div class="custom-select-option" data-value="binary">Binary (GiB, TiB)</div>
                            </div>
                        </div>
                        <input type="hidden" id="sizeUnitSelect" value="decimal">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Auto-refresh</span>
                        <div class="custom-select" id="refreshIntervalWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('refreshIntervalWrapper')">
                                <span class="custom-select-value">1 minute</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="0">Off</div>
                                <div class="custom-select-option" data-value="30">30 seconds</div>
                                <div class="custom-select-option selected" data-value="60">1 minute</div>
                                <div class="custom-select-option" data-value="120">2 minutes</div>
                                <div class="custom-select-option" data-value="300">5 minutes</div>
                                <div class="custom-select-option" data-value="600">10 minutes</div>
                            </div>
                        </div>
                        <input type="hidden" id="refreshIntervalSelect" value="60">
                    </div>
                    
                    <div class="settings-section-title">Storage</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Data retention <span class="info-icon" data-tip="How long SMART readings are kept. Older data is deleted automatically.">ⓘ</span></span>
                        <div class="custom-select" id="retentionWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('retentionWrapper')">
                                <span class="custom-select-value">1 year</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="30">30 days</div>
                                <div class="custom-select-option" data-value="90">90 days</div>
                                <div class="custom-select-option" data-value="180">6 months</div>
                                <div class="custom-select-option selected" data-value="365">1 year</div>
                                <div class="custom-select-option" data-value="730">2 years</div>
                                <div class="custom-select-option" data-value="0">Forever</div>
                            </div>
                        </div>
                        <input type="hidden" id="retentionSelect" value="365">
                    </div>
                    
                    <div class="settings-section-title">API</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Rate limit <span class="info-icon" data-tip="Limit push requests per IP address. Set to 0 to disable rate limiting.">ⓘ</span></span>
                        <div style="display: flex; align-items: center; gap: 6px;">
                            <input type="number" id="rateLimitMax" class="settings-number-input" value="10" min="0" max="1000" onblur="saveRateLimit()" onkeydown="if(event.key==='Enter'){this.blur()}">
                            <span style="font-size: 13px; color: var(--text-muted);">per</span>
                            <input type="number" id="rateLimitWindow" class="settings-number-input" value="60" min="1" max="3600" onblur="saveRateLimit()" onkeydown="if(event.key==='Enter'){this.blur()}">
                            <span style="font-size: 13px; color: var(--text-muted);">sec</span>
                        </div>
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Push token <span class="info-icon" data-tip="Shared secret for authenticating push agents. Leave empty to allow unauthenticated push.">ⓘ</span></span>
                        <div class="token-input-wrap">
                            <input type="password" id="pushTokenInput" class="token-input" placeholder="Not set" onblur="savePushToken()" onkeydown="if(event.key==='Enter'){this.blur()}">
                            <button class="token-icon-btn" onclick="toggleTokenVisibility()" id="tokenVisBtn" title="Show/Hide">
                                <svg id="tokenEyeShow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                <svg id="tokenEyeHide" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                            </button>
                            <button class="token-icon-btn" onclick="copyToken()" id="copyTokenBtn" title="Copy">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                            </button>
                        </div>
                    </div>
                    <div class="settings-row token-regenerate-row">
                        <span class="settings-row-label"></span>
                        <a href="#" class="token-regenerate-link" onclick="generateToken(); return false;">Regenerate token</a>
                    </div>
                </div>
                
                <!-- Notifications Tab -->
                <div class="settings-tab-content" id="tabNotifications">
                    <div class="settings-section-title">Detection</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Threshold <span class="info-icon" data-tip="Threshold profile for alert detection. Independent from dashboard view.">ⓘ</span></span>
                        <div class="custom-select" id="alertThresholdWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('alertThresholdWrapper')">
                                <span class="custom-select-value">Backblaze</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="relaxed">Relaxed</div>
                                <div class="custom-select-option" data-value="conservative">Conservative</div>
                                <div class="custom-select-option selected" data-value="backblaze">Backblaze</div>
                                <div class="custom-select-option" data-value="custom">Custom</div>
                            </div>
                        </div>
                        <input type="hidden" id="alertThresholdPreset" value="backblaze">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">History <span class="info-icon" data-tip="Time range for detecting changes in cumulative counters (e.g. reallocated sectors).">ⓘ</span></span>
                        <div class="custom-select" id="alertHistoryWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('alertHistoryWrapper')">
                                <span class="custom-select-value">7 days</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="1h">1 hour</div>
                                <div class="custom-select-option" data-value="24h">24 hours</div>
                                <div class="custom-select-option selected" data-value="7d">7 days</div>
                                <div class="custom-select-option" data-value="30d">30 days</div>
                                <div class="custom-select-option" data-value="90d">90 days</div>
                                <div class="custom-select-option" data-value="all">all time</div>
                            </div>
                        </div>
                        <input type="hidden" id="alertHistory" value="7d">
                    </div>
                    
                    <div class="settings-section-title">Local</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Alert sound</span>
                        <div class="custom-select" id="alertSoundWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('alertSoundWrapper')">
                                <span class="custom-select-value">Off</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option selected" data-value="off">Off</div>
                                <div class="custom-select-option" data-value="critical"><span class="sev-dot" style="background:#ef4444"></span> Critical only</div>
                                <div class="custom-select-option" data-value="warning"><span class="sev-dot" style="background:#f59e0b"></span> Warning +</div>
                                <div class="custom-select-option" data-value="info"><span class="sev-dot" style="background:#3b82f6"></span> All</div>
                            </div>
                        </div>
                        <input type="hidden" id="alertSoundLevel" value="off">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Keep alerts</span>
                        <div class="custom-select" id="alertRetentionWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('alertRetentionWrapper')">
                                <span class="custom-select-value">14 days</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="0.04">1 hour</div>
                                <div class="custom-select-option" data-value="0.25">6 hours</div>
                                <div class="custom-select-option" data-value="1">24 hours</div>
                                <div class="custom-select-option" data-value="3">3 days</div>
                                <div class="custom-select-option" data-value="7">7 days</div>
                                <div class="custom-select-option selected" data-value="14">14 days</div>
                                <div class="custom-select-option" data-value="30">30 days</div>
                            </div>
                        </div>
                        <input type="hidden" id="alertRetentionDays" value="14">
                    </div>
                    
                    <div class="settings-section-title">Push</div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Severity</span>
                        <div class="custom-select" id="notifyMinSeverityWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('notifyMinSeverityWrapper')">
                                <span class="custom-select-value"><span class="sev-dot" style="background:#f59e0b"></span> Warning +</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="off">Off</div>
                                <div class="custom-select-option" data-value="critical"><span class="sev-dot" style="background:#ef4444"></span> Critical only</div>
                                <div class="custom-select-option selected" data-value="warning"><span class="sev-dot" style="background:#f59e0b"></span> Warning +</div>
                                <div class="custom-select-option" data-value="info"><span class="sev-dot" style="background:#3b82f6"></span> All</div>
                            </div>
                        </div>
                        <input type="hidden" id="notifyMinSeveritySelect" value="warning">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Quiet period <span class="info-icon" data-tip="Minimum time between repeated alerts for the same issue. Prevents notification spam.">ⓘ</span></span>
                        <div class="custom-select" id="notifyCooldownWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('notifyCooldownWrapper')">
                                <span class="custom-select-value">1 hour</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options">
                                <div class="custom-select-option" data-value="0">Off</div>
                                <div class="custom-select-option" data-value="15">15 min</div>
                                <div class="custom-select-option" data-value="30">30 min</div>
                                <div class="custom-select-option selected" data-value="60">1 hour</div>
                                <div class="custom-select-option" data-value="120">2 hours</div>
                                <div class="custom-select-option" data-value="360">6 hours</div>
                                <div class="custom-select-option" data-value="1440">24 hours</div>
                            </div>
                        </div>
                        <input type="hidden" id="notifyCooldown" value="60">
                    </div>
                    
                    <div class="settings-row">
                        <span class="settings-row-label">Recovery <span class="info-icon" data-tip="Send notification when disk status improves (e.g. warning → ok).">ⓘ</span></span>
                        <label class="wh-toggle"><input type="checkbox" id="notifyRecoveryToggle" onchange="saveNotifySettings()"><span class="wh-slider"></span></label>
                    </div>
                    
                    <div class="settings-section-title">Endpoints <span class="info-icon" data-tip="Destinations for alert notifications. Add services like ntfy, Slack, Discord, or email.">ⓘ</span></div>
                    
                    <div class="endpoint-add-row">
                        <div class="custom-select endpoint-service-select" id="endpointServiceWrapper">
                            <div class="custom-select-trigger" onclick="toggleDropdown('endpointServiceWrapper')">
                                <span class="custom-select-value"><span class="svc-icon"></span>ntfy</span>
                                <svg class="custom-select-arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                            </div>
                            <div class="custom-select-options" id="endpointServiceOptions"></div>
                        </div>
                        <input type="text" id="webhookUrlInput" class="endpoint-input showing-service" value="ntfy" placeholder="https://ntfy.sh/your-topic" onfocus="onEndpointInputFocus()" onkeydown="if(event.key==='Enter'){addWebhookUrl()}">
                        <button class="endpoint-add-btn" onclick="addWebhookUrl()">Add</button>
                    </div>
                    
                    <div id="webhookUrlsList" class="endpoint-list"></div>
                    <div id="notifyStatus" class="endpoint-status"></div>
                </div>
                
                <!-- Thresholds Tab -->
                <div class="settings-tab-content" id="tabThresholds">
                    <div class="threshold-content">
                        <div class="settings-section-title">Preset</div>
                        
                        <div class="preset-buttons">
                            <button class="preset-btn" data-preset="relaxed" onclick="selectEditorPreset('relaxed')">Relaxed</button>
                            <button class="preset-btn" data-preset="conservative" onclick="selectEditorPreset('conservative')">Conservative</button>
                            <button class="preset-btn" data-preset="backblaze" onclick="selectEditorPreset('backblaze')">Backblaze</button>
                            <button class="preset-btn" data-preset="custom" onclick="selectEditorPreset('custom')">Custom</button>
                        </div>
                        <p class="preset-hint" id="presetHint">Based on Backblaze failure data from 300k+ drives.</p>
                        
                        <div class="settings-section-title">ATA / SATA <span class="info-icon" data-tip="Traditional hard drives (HDD) and SATA solid-state drives (SSD). Uses normalized SMART attributes.">ⓘ</span></div>
                        <table class="threshold-table" id="ataThresholds">
                            <thead><tr><th>Attribute</th><th class="col-warning">Warning</th><th class="col-critical">Critical</th></tr></thead>
                            <tbody></tbody>
                        </table>
                        
                        <div class="settings-section-title">NVMe <span class="info-icon" data-tip="NVMe solid-state drives connected via PCIe. Uses vendor-specific health metrics.">ⓘ</span></div>
                        <table class="threshold-table" id="nvmeThresholds">
                            <thead><tr><th>Attribute</th><th class="col-warning">Warning</th><th class="col-critical">Critical</th></tr></thead>
                            <tbody></tbody>
                        </table>
                        
                        <div class="threshold-actions" id="thresholdActions">
                            <a href="#" class="threshold-reset-link" id="resetPresetBtn" onclick="resetPresetToDefaults(); return false;" style="display:none;">Reset to defaults</a>
                            <span class="threshold-status" id="thresholdStatus"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="/static/js/dashboard.js"></script>
    <!-- Archive Modal -->
    <div class="modal-overlay" id="archiveModal" onclick="if(event.target === this) closeArchiveModal()">
        <div class="modal">
            <div class="modal-title">Move to Archive?</div>
            <div class="modal-text">History data is preserved and you can restore it anytime from the Archive section.</div>
            <div class="modal-actions">
                <button class="modal-btn modal-btn-cancel" onclick="closeArchiveModal()">Cancel</button>
                <button class="modal-btn modal-btn-confirm" onclick="confirmArchive()">Archive</button>
            </div>
        </div>
    </div>
</body>
</html>
